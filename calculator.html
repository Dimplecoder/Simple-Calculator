<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Calculator</title>
  <style>
    :root{
      --bg:#0f1724; 
      --panel:#0b1320;
      --accent:#7c3aed;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(135deg,var(--bg),#071028 80%);
      display:flex;align-items:center;justify-content:center;padding:24px;color:#e6eef8;
    }

    .calculator{
      width:360px;
      border-radius:16px;
      padding:18px;
      background: linear-gradient(180deg,var(--panel), rgba(11,19,32,0.85));
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      backdrop-filter: blur(6px);
    }

    .screen{
      height:84px;
      border-radius:12px;
      background:var(--glass);
      padding:12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-end;
      gap:6px;
      margin-bottom:14px;
      overflow:hidden;
    }
    .small{font-size:14px;color:var(--muted);
      opacity:0.9;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;}
    .big{font-size:28px;font-weight:600;}

    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    button{
      height:56px;border-radius:12px;border:0;outline:0;cursor:pointer;font-size:18px;font-weight:600;
      box-shadow: 0 6px 14px rgba(2,6,23,0.4);
      transition:transform .08s ease, box-shadow .08s ease;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#e6eef8;
    }
    button:active{transform:translateY(2px);box-shadow:none}

    .btn-op{background:linear-gradient(180deg,#1f2937, #111827); color:var(--accent);}
    .btn-accent{background:linear-gradient(180deg,#7c3aed33,#7c3aed11); color:var(--accent)}
    .btn-eq{grid-column:span 2;height:56px;background:linear-gradient(180deg,var(--accent),#5b21b6);color:white}
    .btn-wide{grid-column:span 2}

    @media (max-width:420px){.calculator{width:100%}}
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculator">
    <div class="screen" id="screen">
      <div class="small" id="expression" aria-hidden="true">&nbsp;</div>
      <div class="big" id="output" aria-live="polite">0</div>
    </div>

    <div class="keys">
      <button class="btn-op" data-action="clear" aria-label="clear">C</button>
      <button class="btn-op" data-action="back" aria-label="backspace">⌫</button>
      <button class="btn-op" data-value="%">%</button>
      <button class="btn-op" data-value="/">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="btn-op" data-value="*">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="btn-op" data-value="-">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="btn-op" data-value="+">+</button>

      <button class="btn-wide" data-value="0">0</button>
      <button data-value=".">.</button>
      <button class="btn-eq" data-action="equals" aria-label="equals">=</button>
    </div>
  </main>

  <script>

    const expressionEl = document.getElementById('expression');
    const outputEl = document.getElementById('output');
    let expr = '';

    function sanitizeForDisplay(s){
      return s.replace(/\*/g,'×').replace(/\//g,'÷');
    }

    function updateScreen(){
      expressionEl.textContent = expr || '\xa0';
      outputEl.textContent = expr ? prettyResultPreview(expr) : '0';
    }

    function prettyResultPreview(e){
      try{
        const val = evaluate(e);
        return String(val);
      }catch{
        return '...';
      }
    }

    function append(value){
      
      const last = expr.slice(-1);
      if(/[+\-*/%]/.test(value)){
        if(expr === '' && value !== '-') return; 
        if(/[+\-*/%]/.test(last)){
          
          expr = expr.slice(0,-1) + value;
          updateScreen();
          return;
        }
      }

  
      if(value === '.'){
        
        const lastOpIndex = Math.max(...['+','-','*','/','%'].map(op=>expr.lastIndexOf(op)));
        const lastNumber = expr.slice(lastOpIndex+1);
        if(lastNumber.includes('.')) return;
      }

      expr += value;
      updateScreen();
    }

    function clearAll(){ expr = ''; updateScreen(); }
    function backspace(){ expr = expr.slice(0,-1); updateScreen(); }

    function evaluate(input){
   
      if(!/^[0-9+\-*/().%\s]+$/.test(input)) throw new Error('Invalid chars');
      
      const replaced = input.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
   
      const result = Function('return '+replaced)();
      
      return Math.round((result + Number.EPSILON) * 100000000) / 100000000;
    }

    function doEquals(){
      try{
        const val = evaluate(expr || '0');
        expr = String(val);
        updateScreen();
      }catch(e){
        outputEl.textContent = 'Error';
      }
    }

    document.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const v = btn.dataset.value;
        const action = btn.dataset.action;
        if(action === 'clear') return clearAll();
        if(action === 'back') return backspace();
        if(action === 'equals') return doEquals();
        if(v) return append(v);
      });
    });

    
    window.addEventListener('keydown', (ev)=>{
      const k = ev.key;
      if(/^[0-9]$/.test(k)) append(k);
      else if(k === '.') append(k);
      else if(k === 'Enter' || k === '=') { ev.preventDefault(); doEquals(); }
      else if(k === 'Backspace') backspace();
      else if(k === 'Escape') clearAll();
      else if(['+','-','*','/','%','(',')'].includes(k)) append(k);
    });

    
    updateScreen();
  </script>
</body>
</html>
